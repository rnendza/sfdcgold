<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>apex_action_Create_Assets_from_IR_Line</name>
        <label>Create Assets from IR Line</label>
        <locationX>556</locationX>
        <locationY>351</locationY>
        <actionName>FlowAction_CreateAssetsFromIRLineItems</actionName>
        <actionType>apex</actionType>
        <inputParameters>
            <name>irLineItemIds</name>
            <value>
                <elementReference>varInputRecordId</elementReference>
            </value>
        </inputParameters>
        <outputParameters>
            <assignToReference>varOutputErrorMsg</assignToReference>
            <name>errorMsg</name>
        </outputParameters>
        <outputParameters>
            <assignToReference>varOutputLineItemId</assignToReference>
            <name>irLineItemId</name>
        </outputParameters>
        <outputParameters>
            <assignToReference>varOutputNumberOfAssetsCreated</assignToReference>
            <name>iNumAssetsCreated</name>
        </outputParameters>
        <outputParameters>
            <assignToReference>varOutputSuccess</assignToReference>
            <name>success</name>
        </outputParameters>
        <outputParameters>
            <assignToReference>varOutputTechMsg</assignToReference>
            <name>techMsg</name>
        </outputParameters>
    </actionCalls>
    <apiVersion>49.0</apiVersion>
    <decisions>
        <description>IR Line Item is eligible to create assets</description>
        <name>Allow_Asset_Create</name>
        <label>Allow Asset Create?</label>
        <locationX>235</locationX>
        <locationY>361</locationY>
        <defaultConnector>
            <targetReference>Log_No_Action_Taken</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Create_Assets</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varTmpInventoryRequestLineItem.Eligible_to_Create_Assets__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>apex_action_Create_Assets_from_IR_Line</targetReference>
            </connector>
            <label>Create Assets</label>
        </rules>
        <rules>
            <name>Exit_and_Log_Ineligible_Error</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varTmpInventoryRequestLineItem.Eligible_to_Create_Assets__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Handle_Ineligible_to_Create_Assets</targetReference>
            </connector>
            <label>Exit and Log Ineligible Error</label>
        </rules>
    </decisions>
    <description>The Flow will.
1. Validate that Assets can be created for this inventory request line item.
    a. If not.. then log an error in Accel_Application_Log__c and return
2. If valid.. it will call the apex invokable to do the heavy lifting. and then return information in varOutputxxxx
3. If the default outcome (could not find the record id or criteria not meant, it will log and then exit.</description>
    <formulas>
        <name>varExecutingUser</name>
        <dataType>String</dataType>
        <expression>{!$User.Id}</expression>
    </formulas>
    <formulas>
        <name>varFFUnableToFindRecordId</name>
        <dataType>String</dataType>
        <expression>&apos;Unable to find input param of record id = &apos; +{!varInputRecordId}</expression>
    </formulas>
    <formulas>
        <name>varNotEligibleToCreateAssetsMsg</name>
        <dataType>String</dataType>
        <expression>&apos;An Attempt was made via Flow - InventoryRequestLineItem_Flow to create assets on an inventory request line item. is not eligible to create assets.. IR Line Item = &apos;</expression>
    </formulas>
    <interviewLabel>InventoryRequestLineItem Processor {!$Flow.CurrentDateTime}</interviewLabel>
    <label>flow_InventoryRequestLineItem_CreateAssets</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <description>Retrieves additional information about the IR Line item using the SFDC Id. This is a double check to make sure the criteria to create assets on the line is satisfied before doing the heaving lifting in the apex (we really don&apos;t have to do this here as the UI stops this as well but it&apos;s merely a defensive move in case other things call this flow as well.</description>
        <name>Find_IR_LI_Record</name>
        <label>Find IR LI Record</label>
        <locationX>243</locationX>
        <locationY>194</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Allow_Asset_Create</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Log_Error_Finding_Record</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varInputRecordId</elementReference>
            </value>
        </filters>
        <object>Inventory_Request_Line_Item__c</object>
        <outputReference>varTmpInventoryRequestLineItem</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Eligible_to_Create_Assets__c</queriedFields>
    </recordLookups>
    <start>
        <locationX>32</locationX>
        <locationY>194</locationY>
        <connector>
            <targetReference>Find_IR_LI_Record</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <subflows>
        <name>Handle_Ineligible_to_Create_Assets</name>
        <label>Log Ineligible to Create Assets</label>
        <locationX>45</locationX>
        <locationY>349</locationY>
        <flowName>flow_AccelApplicationError_CommonErrorHandling</flowName>
        <inputAssignments>
            <name>varInputErrorMsg</name>
            <value>
                <elementReference>varNotEligibleToCreateAssetsMsg</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>varInputRecordId</name>
            <value>
                <elementReference>varInputRecordId</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <subflows>
        <name>Log_Error_Finding_Record</name>
        <label>Log Error Finding Record</label>
        <locationX>395</locationX>
        <locationY>50</locationY>
        <flowName>flow_AccelApplicationError_CommonErrorHandling</flowName>
        <inputAssignments>
            <name>varInputErrorMsg</name>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>varInputRecordId</name>
            <value>
                <elementReference>varInputRecordId</elementReference>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>varOutputErrorMsg</assignToReference>
            <name>varOutputErrorMsg</name>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>varInputRecordId</assignToReference>
            <name>varOutputRecordId</name>
        </outputAssignments>
    </subflows>
    <subflows>
        <name>Log_No_Action_Taken</name>
        <label>Log No Action Taken</label>
        <locationX>240</locationX>
        <locationY>523</locationY>
        <flowName>flow_AccelApplicationError_CommonErrorHandling</flowName>
        <inputAssignments>
            <name>varInputErrorMsg</name>
            <value>
                <elementReference>varFFUnableToFindRecordId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>varInputRecordId</name>
            <value>
                <elementReference>varInputRecordId</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <variables>
        <name>varAccelApplicationError</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Accel_Application_Error__c</objectType>
    </variables>
    <variables>
        <description>The Inventory Request Line Item (SFDC ID)</description>
        <name>varInputRecordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>A Message containing error information when creating assets</description>
        <name>varOutputErrorMsg</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varOutputLineItemId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varOutputNumberOfAssetsCreated</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>varOutputSuccess</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
    <variables>
        <name>varOutputTechMsg</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>Just a placeholder used for eval</description>
        <name>varTmpInventoryRequestLineItem</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Inventory_Request_Line_Item__c</objectType>
    </variables>
</Flow>
