<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>56.0</apiVersion>
    <assignments>
        <name>Assign_Product_Consumed_Field_on_Product_Request_Record</name>
        <label>Assign Product Consumed Field on Product Request Record</label>
        <locationX>143</locationX>
        <locationY>648</locationY>
        <assignmentItems>
            <assignToReference>Get_Associated_Product_Request.Product_Consumed__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>Get_Associated_Product_Request.Product_Consumed_Defined__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Product_Request_Record</targetReference>
        </connector>
    </assignments>
    <decisions>
        <description>Checks if the Product Consumed Number (populated via FSM flow) is over 100. If so, this indicates that the Product Consumed was created from a Parts On Order Product Request, via the &quot;Loop Through Received Product Request&quot; flow. When this is the case, we need to query for the Product Request associated with the Case and Product on this Product Consumed, and we will populate the Product Consumed lookup on that Product Request with this Product Consumed record.</description>
        <name>Is_Product_Consumed_Number_Higher_than_100</name>
        <label>Is Product Consumed Number Higher than 100?</label>
        <locationX>473</locationX>
        <locationY>288</locationY>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes_HigherThan100</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Product_Consumed_Number__c</leftValueReference>
                <operator>GreaterThanOrEqualTo</operator>
                <rightValue>
                    <numberValue>100.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Associated_Product_Request</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_Record_Found</name>
        <label>Is Record Found?</label>
        <locationX>275</locationX>
        <locationY>528</locationY>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes_RecordFound</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Associated_Product_Request</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Product_Consumed_Field_on_Product_Request_Record</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <environments>Default</environments>
    <interviewLabel>Product Consumed - After Create {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Product Consumed - After Create</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Get_Associated_Product_Request</name>
        <label>Get Associated Product Request</label>
        <locationX>275</locationX>
        <locationY>408</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Is_Record_Found</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Product_Consumed_Number__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Product_Consumed_Number__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>CaseId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Case__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>ProductRequest</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_Product_Request_Record</name>
        <label>Update Product Request Record</label>
        <locationX>143</locationX>
        <locationY>768</locationY>
        <inputReference>Get_Associated_Product_Request</inputReference>
    </recordUpdates>
    <start>
        <locationX>50</locationX>
        <locationY>0</locationY>
        <object>ProductConsumed</object>
        <recordTriggerType>Create</recordTriggerType>
        <scheduledPaths>
            <name>X1_Minute_After_Creation</name>
            <connector>
                <targetReference>Is_Product_Consumed_Number_Higher_than_100</targetReference>
            </connector>
            <label>1 Minute After Creation</label>
            <offsetNumber>1</offsetNumber>
            <offsetUnit>Minutes</offsetUnit>
            <recordField>CreatedDate</recordField>
            <timeSource>RecordField</timeSource>
        </scheduledPaths>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
</Flow>
